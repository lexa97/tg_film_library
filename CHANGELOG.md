# История изменений

## [0.1.0] - 2026-01-31

### Добавлено

#### Этап 0: Подготовка окружения
- ✅ Структура проекта (app/, tests/, alembic/)
- ✅ requirements.txt с зависимостями
- ✅ Конфигурация через pydantic-settings (config.py)
- ✅ .gitignore, .env.example

#### Этап 1: База данных
- ✅ Модели SQLAlchemy (User, Group, GroupMember, Film, GroupFilm, Watched)
- ✅ Асинхронный движок и сессии (database.py)
- ✅ Репозитории для всех сущностей с базовым классом
- ✅ Инициализация Alembic для миграций
- ✅ Структура для автогенерации миграций

#### Этап 2: Интеграция с TMDB
- ✅ Pydantic DTO модели (FilmSearchResult, FilmCreate)
- ✅ Базовый абстрактный класс провайдера (BaseFilmSearchProvider)
- ✅ Реализация TMDB провайдера (TMDBFilmSearch)
- ✅ Поиск фильмов с учетом мультиязычности
- ✅ Получение деталей фильма
- ✅ Обработка постеров и описаний

#### Этап 3: Сервисы бизнес-логики
- ✅ UserGroupService (управление пользователями и группами)
  - Регистрация пользователей
  - Создание групп
  - Добавление участников по контакту
  - Проверка прав администратора
- ✅ FilmService (работа с фильмами)
  - Поиск фильмов через TMDB
  - Создание/получение фильмов в БД
- ✅ GroupFilmService (список фильмов группы)
  - Добавление фильмов в группу
  - Получение списка с пагинацией
  - Отметка просмотренным
  - Поиск по названию
- ✅ NotificationService (уведомления)
  - Уведомления о добавлении фильма
  - Уведомления о просмотре
  - Уведомления о добавлении в группу
  - Обработка заблокированных ботов

#### Этап 4: FSM состояния
- ✅ CreateGroupStates для создания группы

#### Этап 5: Клавиатуры
- ✅ Главное меню
- ✅ Подтверждение фильма при поиске
- ✅ Список фильмов с пагинацией
- ✅ Детали фильма с кнопкой "Просмотрено"

#### Этап 6: Хендлеры Telegram
- ✅ commands.py - /start, /list
- ✅ group.py - создание группы через FSM
- ✅ member.py - добавление участников по контакту
- ✅ film.py - поиск и подтверждение фильмов
- ✅ list.py - список фильмов, детали, отметка просмотренным

#### Этап 7: Middleware и точка входа
- ✅ DatabaseMiddleware для инъекции сессии БД
- ✅ main.py с регистрацией роутеров
- ✅ Логирование в консоль

#### Этап 8: Docker Compose
- ✅ Dockerfile для бота
- ✅ docker-compose.yml с PostgreSQL и ботом
- ✅ Автоматические миграции при старте
- ✅ Health checks для БД
- ✅ .dockerignore

#### Этап 9: Тесты
- ✅ conftest.py с фикстурами
- ✅ Тесты UserGroupService
- ✅ Тесты FilmService
- ✅ Тесты GroupFilmService
- ✅ Использование in-memory SQLite для тестов

#### Этап 10: Полировка
- ✅ README.md с подробной документацией
- ✅ QUICKSTART.md с инструкциями по запуску
- ✅ Makefile для удобства разработки
- ✅ ruff.toml для линтера
- ✅ pytest.ini для тестов

### Архитектура

- Строгое разделение ответственности (Handlers → Services → Repositories)
- Вся бизнес-логика в классах
- Асинхронная работа с БД через SQLAlchemy 2.0
- Dependency Injection через middleware
- Pydantic модели для валидации данных

### Особенности реализации

- MVP: один пользователь — одна группа
- Отметка "просмотрен" общая на группу
- Поддержка мультиязычного поиска через TMDB
- Уведомления всем участникам группы
- Пагинация списка фильмов (10 на странице)
- Обработка заблокированных ботов

### Что можно улучшить в будущем

- [ ] Поддержка нескольких групп на пользователя
- [ ] Кэширование запросов к TMDB
- [ ] Rate limiting для TMDB API
- [ ] Детальная статистика по просмотрам
- [ ] Экспорт списка фильмов
- [ ] Рейтинги и комментарии к фильмам
- [ ] Поддержка других источников (OMDb, Kinopoisk)
- [ ] Web-интерфейс для управления
