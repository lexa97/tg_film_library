# Кинобиблиотека группы — Telegram-бот

Общий список фильмов/сериалов для группы пользователей: поиск по TMDB, добавление в список, отметка «просмотрено», уведомления участникам.

## Стек

- Python 3.11+
- aiogram 3.x
- PostgreSQL 14+
- SQLAlchemy 2 (async), Alembic
- TMDB API

## Установка

1. Клонировать репозиторий, перейти в каталог проекта.

2. Создать виртуальное окружение и установить зависимости:

   ```bash
   python -m venv venv
   venv\Scripts\activate   # Windows
   pip install -r requirements.txt
   ```

3. Создать файл `.env` по образцу `.env.example`:

   - `BOT_TOKEN` — токен бота от [@BotFather](https://t.me/BotFather)
   - `DATABASE_URL` — строка подключения к PostgreSQL, например:  
     `postgresql+asyncpg://user:password@localhost:5432/tg_film_library`
   - `TMDB_API_KEY` — ключ API с [themoviedb.org](https://www.themoviedb.org/settings/api)

4. Создать БД в PostgreSQL и при первом запуске таблицы создадутся автоматически. Либо выполнить миграции:

   ```bash
   alembic upgrade head
   ```

## Запуск

### Локально

Из корня проекта:

```bash
python main.py
```

или

```bash
python -m app.main
```

### Docker Compose

1. Создать `.env` из `.env.example` и заполнить `BOT_TOKEN` и `TMDB_API_KEY`. Переменные `POSTGRES_*` опциональны (есть значения по умолчанию).

2. Запустить сервисы:

   ```bash
   docker compose up -d
   ```

   Бот и PostgreSQL поднимутся в фоне. При первом запуске таблиц ещё нет — перед стартом бота выполняется `alembic upgrade head` (если есть миграции), иначе таблицы создаются при старте приложения через `create_all`.

3. Остановить:

   ```bash
   docker compose down
   ```

   Данные БД сохраняются в volume `pgdata`. Для удаления с данными: `docker compose down -v`.

## Использование

- **/start** — приветствие; если пользователь не в группе — подсказка, как добавиться.
- **/newgroup** — создание группы (админ вводит название).
- **Отправка контакта** — админ добавляет участника в группу (контакт через «Поделиться контактом» из профиля; пользователь должен уже нажать /start у бота).
- **Текст (название фильма)** — поиск в TMDB, карточки с кнопкой «Подтвердить»; по нажатию фильм добавляется в список группы, всем участникам приходит уведомление.
- **/list** или кнопка «Мой список» — список фильмов группы в виде inline-кнопок; по нажатию на название — описание фильма и кнопка «Просмотрено».
- **«Просмотрено»** — общая отметка на группу; всем участникам уведомление.

Подробное ТЗ — в [task.md](task.md).
